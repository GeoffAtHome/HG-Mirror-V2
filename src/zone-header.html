<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="last-seen.html">
<link rel="import" href="shared-styles.html">


<dom-module id="zone-header">
    <template>
        <style include="iron-flex iron-flex-alignment shared-styles">
            :host {
                display: inline-block;
                width: 100%;
                margin: 0px;
                height: 28px;
                color: white;
                background-color: var(--app-primary-color);
                font-size: 20px;
                border-radius: 5px 5px 0 0;
                box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.14), 0 1px 5px 0 rgba(0, 0, 0, 0.12), 0 3px 1px -2px rgba(0, 0, 0, 0.2);
            }

            :host([on]) {
                background-color: orange;
            }

            paper-icon-button {
                margin: 0px;
                padding: 1px;
                width: 28px;
                height: 28px;
            }

            paper-icon-button:hover {
                background-color: var(--paper-green-500);
                color: white;
            }

            paper-icon-button.on {
                color: black;
                --paper-icon-button-ink-color: pink;
            }

            paper-icon-button.on:hover {
                background-color: var(--paper-pink-500);
                color: white;
            }
        </style>
        <div class="layout horizontal justified top">
            <div class="layout horizontal layout-start">
                <paper-icon-button class$="[[isOff(zone)]]" title="Off" icon="my-icons:off" on-click="_off"></paper-icon-button>
                <paper-icon-button class$="[[isBoost(zone)]]" title="Boost" icon="my-icons:boost" on-click="_boost"></paper-icon-button>
                <paper-icon-button class$="[[isTimer(zone)]]" title="Timer" icon="my-icons:timer" on-click="_timer"></paper-icon-button>
                <template is="dom-if" if="[[isNotSwitch(zone)]]">
                    <paper-icon-button class$="[[isFootprint(zone)]]" title="Footprint" icon="my-icons:footprint" on-click="_footprint"></paper-icon-button>
                </template>
            </div>
            <span>[[zone.strName]]</span>
            <div>
                <last-seen down lastseen="[[getBoost(zone)]]"></last-seen>
            </div>
        </div>
    </template>

    <script>
        class ZoneHeader extends Polymer.Element {
            static get is() {
                return 'zone-header';
            }

            static get properties() {
                return {
                    zone: Object
                };
            }

            isNotSwitch(zone) {
                if (zone.nodes[0].childValues['SwitchBinary'] == undefined) {
                    return true;
                }
                return false;
            }

            getBoost(zone) {
                if (zone.iMode === 16) {
                    return zone.iBoostTimeRemaining;
                }
                return -1;
            }

            // Mode_Off: 1,
            // Mode_Timer: 2,
            // Mode_Footprint: 4,
            // Mode_Away: 8,
            // Mode_Boost: 16,
            // Mode_Early: 32,
            // Mode_Test: 64,
            // Mode_Linked: 128,
            // Mode_Other: 256
            isOff(zone) {
                if (zone.iMode === 1 || zone.iMode === 8) {
                    return 'on';
                }
            }


            isTimer(zone) {
                if (zone.iMode === 2) {
                    return 'on';
                }

            }

            isFootprint(zone) {
                if (zone.iMode === 4) {
                    return 'on';
                }
            }

            isBoost(zone) {
                if (zone.iMode === 16) {
                    return 'on';
                }
            }

            _boost(event) {
                this.dispatchEvent(new CustomEvent('boost-dialog', {
                    bubbles: true,
                    composed: true,
                    detail: this.zone
                }));
                event.stopPropagation();
            }

            _timer(event) {
                return this.changeMode(event, 2);
            }

            _off(event) {
                return this.changeMode(event, 1);
            }

            _footprint(event) {
                return this.changeMode(event, 4);
            }

            changeMode(event, mode) {
                this.dispatchEvent(new CustomEvent('update-timer', {
                    bubbles: true,
                    composed: true,
                    detail: {
                        addr: this.zone.iID,
                        data: {
                            iMode: mode
                        }
                    }
                }));
                event.stopPropagation();
            }
        }

        window.customElements.define(ZoneHeader.is, ZoneHeader);
    </script>
</dom-module>